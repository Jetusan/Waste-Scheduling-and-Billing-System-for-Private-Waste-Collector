# WSBS Deployment Guide - Render + Neon

This guide covers deploying the WSBS (Waste Scheduling and Billing System) to Render with a Neon PostgreSQL database.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **Neon Account**: Sign up at [neon.tech](https://neon.tech)
3. **GitHub Repository**: Your code should be in a GitHub repository

## Step 1: Set up Neon Database

1. Create a new Neon project
2. Create a database (e.g., `waste_collection_db`)
3. Note down your connection details (keep these secure - don't commit to GitHub):
   - Host: `ep-summer-scene-a1rlu78r-pooler.ap-southeast-1.aws.neon.tech`
   - Database: `neondb`
   - Username: `neondb_owner`
   - Password: `npg_DZf0c3qxWQim`
   - Port: `5432`

## Step 2: Deploy to Render

### Option A: Using render.yaml (Recommended)

1. **Connect Repository**:
   - Go to Render Dashboard
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

2. **Set Environment Variables**:
   After deployment starts, you'll need to set these environment variables in the Render dashboard:

   **For wsbs-backend service:**
   ```
   DB_HOST=your-neon-host
   DB_NAME=waste_collection_db
   DB_USER=your-neon-username
   DB_PASSWORD=your-neon-password
   PAYMONGO_PUBLIC_KEY=your-paymongo-public-key
   PAYMONGO_SECRET_KEY=your-paymongo-secret-key
   PAYMONGO_WEBHOOK_SECRET=your-paymongo-webhook-secret
   EMAIL_USER=your-email@gmail.com (if using email features)
   EMAIL_PASSWORD=your-email-app-password
   ```

### Option B: Manual Deployment

If you prefer manual setup:

1. **Deploy Backend**:
   - New → Web Service
   - Connect repository
   - Root Directory: `backend`
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Set all environment variables listed above

2. **Deploy Frontend**:
   - New → Static Site
   - Connect repository
   - Root Directory: `admin`
   - Build Command: `npm install && npm run build`
   - Publish Directory: `build`
   - Environment Variables:
     ```
     REACT_APP_API_URL=https://your-backend-url.onrender.com
     REACT_APP_ENVIRONMENT=production
     ```

## Step 3: Database Setup

1. **Run Database Migrations**:
   Once your backend is deployed, you may need to run the initial database setup:
   - Use Render's shell feature or connect to your database directly
   - Run the SQL files in `backend/config/` directory:
     - `init.sql` (main tables)
     - `collector_emergency_tables.sql` (emergency features)
     - `enhanced_missed_collection_schema.sql` (missed collections)
     - `feedback_table.sql` (feedback system)

## Step 4: Update Service URLs

After deployment, update the following in your Render environment variables:

1. **Backend Service**: Update `FRONTEND_URL` to your actual frontend URL
2. **Frontend Service**: Update `REACT_APP_API_URL` to your actual backend URL

## Step 5: Test Deployment

1. **Health Check**: Visit `https://your-backend-url.onrender.com/health`
2. **Frontend**: Visit your frontend URL
3. **Database Connection**: Check logs for successful database connection

## Important Notes

### Environment Variables Required

**Backend (wsbs-backend):**
- `DB_HOST`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_PORT` - Neon database credentials
- `JWT_SECRET` - Auto-generated by Render
- `PAYMONGO_*` - PayMongo payment integration
- `EMAIL_*` - Email service configuration
- `FRONTEND_URL` - Your frontend URL for CORS

**Frontend (wsbs-admin):**
- `REACT_APP_API_URL` - Your backend URL
- `REACT_APP_ENVIRONMENT=production`

### Security Considerations

1. **Never commit sensitive data** like API keys or database passwords
2. **Use Render's environment variables** for all sensitive configuration
3. **Enable HTTPS** (Render provides this automatically)
4. **Set up proper CORS** origins in your backend configuration

### Troubleshooting

1. **Build Failures**: Check build logs in Render dashboard
2. **Database Connection Issues**: Verify Neon credentials and whitelist Render IPs
3. **CORS Errors**: Ensure frontend URL is in backend CORS configuration
4. **API Errors**: Check backend logs and ensure all environment variables are set

### Monitoring

- **Health Checks**: Backend includes `/health` endpoint
- **Logs**: Monitor both services through Render dashboard
- **Database**: Monitor through Neon dashboard

## Post-Deployment

1. **Test all features**: Login, dashboard, billing, scheduling
2. **Set up monitoring**: Use Render's monitoring features
3. **Configure backups**: Set up database backups in Neon
4. **Update documentation**: Update any hardcoded URLs in your documentation

## Support

If you encounter issues:
1. Check Render build/deploy logs
2. Check Neon database connectivity
3. Verify all environment variables are set correctly
4. Test API endpoints individually

Your WSBS application should now be fully deployed and accessible via your Render URLs!
